<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Level 9 – VITRASA MEMORY</title>

<style>
  body{margin:0;font-family:Arial,sans-serif;background:#ffffff;color:#000;text-align:center;padding:20px}
  #logo{width:180px;margin:20px auto;display:block}
  #loader{position:fixed;inset:0;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
  #loader img{width:200px}
  #progress{width:300px;height:20px;background:#444;border-radius:10px;margin-top:20px;overflow:hidden}
  #progress-fill{height:100%;width:0;background:#0f0}
  #tablero{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:30px;padding:10px}
  .carta{width:180px;height:180px;background:#222;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center}
  .carta img{width:100%;height:100%;object-fit:cover;border-radius:10px;display:none}
  .flipped img{display:block}
  .flipped span{display:none}
  .msg-temp{position:fixed;top:18px;left:50%;transform:translateX(-50%);padding:8px 14px;border-radius:8px;color:#fff;z-index:99999}
</style>
</head>
<body>

<!-- Loader -->
<div id="loader" aria-hidden="false">
  <img src="https://vitrasa.es/documents/752794/2317260/LoaderAvanza.gif" alt="Cargando..." />
  <div id="progress"><div id="progress-fill"></div></div>
</div>

<!-- Logo -->
<img id="logo" src="https://intranet.vitrasa.es/img/logo_vitrasa.png" alt="Logo" />
<h1>Nivel 9</h1>
<p>Levanta todos los pares</p>

<div id="tablero" aria-live="polite"></div>

<script>
/* ---------------------------
   CONFIG: lista de imágenes
   --------------------------- */
let imagenesBase = [
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/0477b49e-66ba-4d95-8e40-3f3e9dca3bf7_16-9-aspect-ratio_1600w_0.webp",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/0e36381b-d1eb-445c-92c8-fa40f4a82983_16-9-aspect-ratio_50p_0.jpg",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/1ebca628-c37b-4d27-8345-6cae0df9f64a_16-9-aspect-ratio_1600w_0.webp",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/48a9e931-84ec-47ee-9fd7-345f6e2416ab_16-9-aspect-ratio_1600w_0.webp",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/5dc9ab86-117f-4d1e-b2e0-fa0b27f0af30_16-9-aspect-ratio_50p_0.jpg",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/753c21c5-199c-4855-b0d1-e080674a9184_16-9-aspect-ratio_50p_1210453.jpg",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/76b09857-a924-4920-948f-52184523bcef_16-9-aspect-ratio_50p_0.jpg",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/9315785a-f355-437f-9a44-ff4f7d508535_16-9-aspect-ratio_1600w_0.webp",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/94bab8a1-6dae-4f74-9a43-8180bfcf0423_16-9-aspect-ratio_1600w_0.webp",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/9dc8613d-60e4-4323-a92f-bea0ade5f255_16-9-aspect-ratio_50p_0.jpg"
];

/* ---------------------------
   CÁLCULO: usar todas las imágenes
   --------------------------- */
function calcularImagenes(imagenes){
  return imagenes.slice(); // copia completa
}

/* ---------------------------
   Loader simulado
   --------------------------- */
let progreso = 0;
let intervalo = null;

function startLoaderAndInit(){
  const fillEl = document.getElementById('progress-fill');
  intervalo = setInterval(()=>{
    progreso = Math.min(100, progreso + 4);
    fillEl.style.width = progreso + '%';
    if(progreso >= 100){
      clearInterval(intervalo);
      document.getElementById('loader').style.display = 'none';
      setTimeout(iniciarNivel, 120);
    }
  }, 40);
}

/* ---------------------------
   Genera tablero
   --------------------------- */
let primera = null;

function iniciarNivel(){
  const seleccion = calcularImagenes(imagenesBase);
  let baraja = [...seleccion, ...seleccion]; // duplicar para pares
  baraja = baraja.sort(()=>Math.random() - 0.5); // mezclar

  const tablero = document.getElementById('tablero');
  tablero.innerHTML = '';

  baraja.forEach(ruta => {
    const carta = document.createElement('div');
    carta.className = 'carta';
    carta.innerHTML = `<span aria-hidden="true">?</span><img src="${ruta}" alt="Carta">`;
    carta.addEventListener('click', ()=>voltear(carta));
    tablero.appendChild(carta);
  });
}

/* ---------------------------
   Lógica de volteo y control de pares
   --------------------------- */
function voltear(carta){
  if(carta.classList.contains('flipped')) return;
  carta.classList.add('flipped');

  if(!primera){
    primera = carta;
    return;
  }

  const img1 = primera.querySelector('img')?.src || '';
  const img2 = carta.querySelector('img')?.src || '';

  if(img1 === img2){
    eventoAcierto();
    primera = null;
    if(document.querySelectorAll('.carta.flipped').length === document.querySelectorAll('.carta').length){
      setTimeout(eventoVictoria, 400);
    }
  } else {
    setTimeout(()=>{
      primera.classList.remove('flipped');
      carta.classList.remove('flipped');
      primera = null;
    }, 600);
  }
}

/* ---------------------------
   Mensaje temporal
   --------------------------- */
function showTempMessage(text, bg='#00cc00', ms=800){
  const aviso = document.createElement('div');
  aviso.className = 'msg-temp';
  aviso.textContent = text;
  aviso.style.background = bg;
  document.body.appendChild(aviso);
  setTimeout(()=>{ aviso.style.opacity = '0'; setTimeout(()=>aviso.remove(), 400); }, ms);
}

function eventoAcierto(){
  showTempMessage('¡Acierto!', '#007f3f', 700);
}

/* ---------------------------
   Victoria
   --------------------------- */
function eventoVictoria(){
  const overlay = document.createElement('div');
  overlay.style.position = 'fixed';
  overlay.style.inset = '0';
  overlay.style.background = 'rgba(0,0,0,0.85)';
  overlay.style.display = 'flex';
  overlay.style.alignItems = 'center';
  overlay.style.justifyContent = 'center';
  overlay.style.zIndex = '100000';
  overlay.innerHTML = `
    <div style="text-align:center;color:white;">
      <p style="font-size:28px;margin:0 0 18px 0">¡Enhorabuena! ¡Nivel completado!</p>
      <div>
        <button id="continuarBtn" style="font-size:18px;padding:10px 16px;border-radius:8px;border:none;cursor:pointer">Continuar</button>
      </div>
    </div>
  `;
  document.body.appendChild(overlay);
  document.getElementById('continuarBtn').addEventListener('click', ()=>{
    window.location.href = "https://lucasmaneirodelatm-dot.github.io/vitrasamemory/level-10.html";
  });
}

/* ---------------------------
   Iniciar loader + nivel
   --------------------------- */
startLoaderAndInit();
</script>

</body>
</html>
