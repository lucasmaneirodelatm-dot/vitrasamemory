<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Level 3 â€“ VITRASA MEMORY</title>

<style>
  body{margin:0;font-family:Arial,sans-serif;background:#ffffff;color:#000;text-align:center;padding:20px}
  #logo{width:180px;margin:20px auto;display:block}
  #loader{position:fixed;inset:0;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
  #loader img{width:200px}
  #progress{width:300px;height:20px;background:#444;border-radius:10px;margin-top:20px;overflow:hidden}
  #progress-fill{height:100%;width:0;background:#0f0}
  #tablero{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:30px;padding:10px}
  .carta{width:180px;height:180px;background:#222;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center}
  .carta img{width:100%;height:100%;object-fit:cover;border-radius:10px;display:none}
  .flipped img{display:block}
  .flipped span{display:none}
  .msg-temp{position:fixed;top:18px;left:50%;transform:translateX(-50%);padding:8px 14px;border-radius:8px;color:#fff;z-index:99999}
</style>
</head>
<body>

<div id="loader">
  <img src="https://vitrasa.es/documents/752794/2317260/LoaderAvanza.gif" alt="Cargando..." />
  <div id="progress"><div id="progress-fill"></div></div>
</div>

<img id="logo" src="https://intranet.vitrasa.es/img/logo_vitrasa.png" alt="Logo" />
<h1>Nivel 3</h1>
<p>Levanta dos parejas</p>

<div id="tablero"></div>

<script>
let imagenesBase = [
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/V12A2727.webp",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/V_20241028_170708000.webp",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/busnadal.webp",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/frecuencias-dinamicas-vitrasa.webp",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/huelga-mayo-23.webp",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/los-recortes-lineas-vitrasa.webp"
];

// ðŸ”§ ARREGLADO: selecciÃ³n aleatoria real
function calcularImagenes(imagenes){
  const multiplicado = imagenes.length / 0.5;
  const tercio = Math.floor(multiplicado / 3);
  const cantidad = Math.max(1, tercio);
  return [...imagenes]
    .sort(()=>Math.random()-0.5)
    .slice(0, Math.min(cantidad, imagenes.length));
}

// Loader
let progreso = 0;
const intervalo = setInterval(()=>{
  progreso += 4;
  document.getElementById('progress-fill').style.width = progreso + '%';
  if(progreso >= 100){
    clearInterval(intervalo);
    document.getElementById('loader').style.display = 'none';
    iniciarNivel();
  }
}, 40);

// Tablero
function iniciarNivel(){
  const seleccion = calcularImagenes(imagenesBase);
  let baraja = [...seleccion, ...seleccion].sort(()=>Math.random()-0.5);

  const tablero = document.getElementById('tablero');
  tablero.innerHTML = '';

  baraja.forEach(img=>{
    const carta = document.createElement('div');
    carta.className = 'carta';
    carta.innerHTML = `<span>?</span><img src="${img}">`;
    carta.onclick = ()=>voltear(carta);
    tablero.appendChild(carta);
  });
}

let primera = null;

function voltear(carta){
  if(carta.classList.contains('flipped')) return;
  carta.classList.add('flipped');

  if(!primera){ primera = carta; return; }

  const a = primera.querySelector('img').src;
  const b = carta.querySelector('img').src;

  if(a === b){
    primera = null;
    if(document.querySelectorAll('.carta.flipped').length === document.querySelectorAll('.carta').length){
      setTimeout(()=>location.href="https://lucasmaneirodelatm-dot.github.io/vitrasamemory/level-4.html",500);
    }
  } else {
    setTimeout(()=>{
      primera.classList.remove('flipped');
      carta.classList.remove('flipped');
      primera = null;
    },600);
  }
}
</script>

</body>
</html>
