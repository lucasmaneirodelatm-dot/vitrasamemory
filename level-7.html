<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Level 7 – VITRASA MEMORY</title>

<style>
body{margin:0;font-family:Arial,sans-serif;background:#fff;color:#000;text-align:center;padding:20px}
#logo{width:180px;margin:20px auto;display:block}
#loader{position:fixed;inset:0;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
#loader img{width:200px}
#progress{width:300px;height:20px;background:#444;border-radius:10px;margin-top:20px;overflow:hidden}
#progress-fill{height:100%;width:0;background:#0f0}
#tablero{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:30px;padding:10px}
.carta{width:180px;height:180px;background:#222;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.carta img{width:100%;height:100%;object-fit:cover;border-radius:10px;display:none}
.flipped img{display:block}
.flipped span{display:none}
.msg-temp{position:fixed;top:18px;left:50%;transform:translateX(-50%);padding:8px 14px;border-radius:8px;color:#fff;z-index:99999}
</style>
</head>
<body>

<div id="loader">
  <img src="https://vitrasa.es/documents/752794/2317260/LoaderAvanza.gif" alt="Cargando..." />
  <div id="progress"><div id="progress-fill"></div></div>
</div>

<img id="logo" src="https://intranet.vitrasa.es/img/logo_vitrasa.png" alt="Logo" />
<h1>Nivel 7</h1>
<p>Levanta dos parejas</p>

<div id="tablero"></div>

<script>
let imagenesBase = [
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/vitrasa_6158.png",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/sin-servicio(1)_en-cocheras.png",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/sin-numero(2)_6836_castelao.png",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/sin-numero(1)_6810_guixar.png",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/VITRASA-y-B45_en-cocheras.png",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/Servicios-minimos_plaza-espana.png",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/Servicios-minimos_L15A_pizarro.png",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/Servicios-minimos_C1(1)_6156_urzaiz%23principe.png",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/Nueva-flota.png",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/Nueva-flota(6).png",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/Nueva-flota(3).png",
  "https://raw.githubusercontent.com/lucasmaneirodelatm-dot/vitrasamemory/refs/heads/main/img/pictures_levels/Nueva-flota(26).png"
];

function calcularImagenes(imagenes){
  const cantidad = Math.max(1, Math.floor(imagenes.length*2/3));
  return imagenes.slice().sort(()=>Math.random()-0.5).slice(0,cantidad);
}

let progreso=0, intervalo=null;
function startLoaderAndInit(){
  const fillEl=document.getElementById('progress-fill');
  intervalo=setInterval(()=>{
    progreso=Math.min(100,progreso+4);
    fillEl.style.width=progreso+'%';
    if(progreso>=100){
      clearInterval(intervalo);
      document.getElementById('loader').style.display='none';
      setTimeout(iniciarNivel,120);
    }
  },40);
}

function iniciarNivel(){
  const seleccion=calcularImagenes(imagenesBase);
  let baraja=[...seleccion,...seleccion];
  if(!baraja.length) baraja=[document.getElementById('logo').src,document.getElementById('logo').src];
  baraja.sort(()=>Math.random()-0.5);
  const tablero=document.getElementById('tablero');
  tablero.innerHTML='';
  baraja.forEach(ruta=>{
    const carta=document.createElement('div');
    carta.className='carta';
    carta.innerHTML=`<span>?</span><img src="${ruta}" alt="Carta">`;
    carta.addEventListener('click',()=>voltear(carta));
    tablero.appendChild(carta);
  });
}

let primera=null;
function voltear(carta){
  if(carta.classList.contains('flipped')) return;
  carta.classList.add('flipped');
  if(!primera){ primera=carta; return; }
  const img1=primera.querySelector('img').src;
  const img2=carta.querySelector('img').src;
  if(img1===img2){
    showTempMessage('¡Acierto!','#007f3f',700);
    primera=null;
    if(document.querySelectorAll('.carta.flipped').length===document.querySelectorAll('.carta').length)
      setTimeout(eventoVictoria,400);
  } else {
    setTimeout(()=>{
      primera.classList.remove('flipped');
      carta.classList.remove('flipped');
      primera=null;
    },600);
  }
}

function showTempMessage(text,bg='#00cc00',ms=800){
  const aviso=document.createElement('div');
  aviso.className='msg-temp';
  aviso.textContent=text;
  aviso.style.background=bg;
  document.body.appendChild(aviso);
  setTimeout(()=>aviso.remove(),ms);
}

function eventoVictoria(){
  const overlay=document.createElement('div');
  overlay.style.position='fixed';
  overlay.style.inset='0';
  overlay.style.background='rgba(0,0,0,0.85)';
  overlay.style.display='flex';
  overlay.style.alignItems='center';
  overlay.style.justifyContent='center';
  overlay.style.zIndex='100000';
  overlay.innerHTML=`
    <div style="text-align:center;color:white;">
      <p style="font-size:28px;margin:0 0 18px 0">¡Enhorabuena! ¡Nivel completado!</p>
      <div><button id="continuarBtn" style="font-size:18px;padding:10px 16px;border-radius:8px;border:none;cursor:pointer">Continuar</button></div>
    </div>
  `;
  document.body.appendChild(overlay);
  document.getElementById('continuarBtn').onclick=()=>window.location.href="https://lucasmaneirodelatm-dot.github.io/vitrasamemory/level-8.html";
}

startLoaderAndInit();
</script>

</body>
</html>
