

‚ùìÔ∏èüöå VITRASA MEMORY













<!doctype html>
<html lang="es" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vitrasa Memory</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Fredoka', sans-serif; }
    
    .card-container {
      perspective: 1000px;
    }
    
    .card-inner {
      transition: transform 0.5s;
      transform-style: preserve-3d;
    }
    
    .card-inner.flipped {
      transform: rotateY(180deg);
    }
    
    .card-front, .card-back {
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }
    
    .card-back {
      transform: rotateY(180deg);
    }
    
    .card-matched {
      animation: matchPulse 0.5s ease;
    }
    
    @keyframes matchPulse {
      0%, 100% { transform: rotateY(180deg) scale(1); }
      50% { transform: rotateY(180deg) scale(1.1); }
    }
    
    .shake {
      animation: shake 0.5s ease;
    }
    
    @keyframes shake {
      0%, 100% { transform: rotateY(180deg); }
      25% { transform: rotateY(180deg) translateX(-5px); }
      75% { transform: rotateY(180deg) translateX(5px); }
    }
    
    .level-btn:hover {
      transform: scale(1.05);
    }
    
    .level-btn.locked {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      pointer-events: none;
      animation: confettiFall 3s ease-out forwards;
    }
    
    @keyframes confettiFall {
      0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    .error-container {
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gradient-to-br from-blue-900 via-blue-800 to-cyan-700 overflow-auto">
  <div id="app" class="min-h-full w-full"><!-- Profile Selection Screen -->
   <div id="profile-screen" class="min-h-full flex flex-col items-center justify-center p-4 bg-gradient-to-br from-blue-900 via-blue-800 to-cyan-700">
    <div class="text-center mb-8">
     <div class="text-6xl mb-2">
      üöå
     </div>
     <h1 id="profile-title" class="text-4xl md:text-5xl font-bold text-white drop-shadow-lg">VITRASA MEMORY</h1>
     <p class="text-blue-200 mt-2">Selecciona tu perfil</p>
    </div>
    <div class="bg-white/10 backdrop-blur-sm rounded-3xl p-8 w-full max-w-2xl">
     <div id="profiles-list" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <!-- Profiles will be generated here -->
     </div>
     <div class="mt-6 space-y-3">
      <input type="text" id="new-profile-name" placeholder="Nuevo perfil" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-blue-300 border border-white/30 focus:outline-none focus:border-yellow-400" maxlength="20"> <button onclick="createNewProfile()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl transition-all">‚ûï Crear Perfil</button>
     </div>
     <div class="mt-4 text-center">
      <button onclick="showAdminPanel()" class="text-blue-300 hover:text-yellow-400 text-sm underline">‚öôÔ∏è Panel Admin</button>
     </div>
    </div>
   </div><!-- Admin Panel Screen -->
   <div id="admin-screen" class="min-h-full hidden flex-col items-center justify-center p-4 bg-gradient-to-br from-blue-900 via-blue-800 to-cyan-700">
    <div class="bg-white/10 backdrop-blur-sm rounded-3xl p-8 w-full max-w-2xl">
     <div class="text-center mb-6">
      <h2 class="text-3xl font-bold text-white">‚öôÔ∏è Panel Admin</h2>
     </div>
     <div id="admin-login" class="space-y-4 mb-6">
      <input type="password" id="admin-password" placeholder="Contrase√±a Admin" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-blue-300 border border-white/30 focus:outline-none focus:border-yellow-400"> <button onclick="validateAdminPassword()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-all">üîì Acceder</button>
     </div>
     <div id="admin-panel" class="hidden space-y-4">
      <h3 class="text-xl font-bold text-white mb-4">Descargar Plantilla JSON</h3>
      <p class="text-blue-200 text-sm mb-4">Descarga la plantilla para crear tu archivo de datos:</p><button onclick="downloadJSONTemplate()" class="w-full bg-yellow-400 hover:bg-yellow-300 text-blue-900 font-bold py-3 px-6 rounded-xl transition-all">üì• Descargar Plantilla JSON</button> <button onclick="downloadLevelGuide()" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-xl transition-all">üìã Descargar Gu√≠a de Niveles</button>
      <hr class="border-white/20 my-4">
      <h3 class="text-xl font-bold text-white mb-4">Gesti√≥n de Datos</h3><button onclick="exportAllProgress()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl transition-all">üíæ Exportar Progreso</button> <button onclick="resetAllProgress()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-xl transition-all">üóëÔ∏è Limpiar Todo</button>
     </div><button onclick="backToProfiles()" class="w-full mt-6 bg-white/20 hover:bg-white/30 text-white font-bold py-2 px-4 rounded-xl transition-all">‚Üê Volver</button>
    </div>
   </div><!-- Loading Screen -->
   <div id="loading-screen" class="min-h-full hidden flex-col items-center justify-center p-4">
    <div class="text-6xl mb-4">
     üöå
    </div>
    <h1 class="text-3xl font-bold text-white mb-4">Cargando...</h1>
    <div class="w-64 h-3 bg-blue-950 rounded-full overflow-hidden">
     <div id="loading-bar" class="h-full bg-yellow-400 rounded-full transition-all duration-300" style="width: 0%"></div>
    </div>
    <p id="loading-text" class="text-blue-200 mt-2">Conectando con el servidor...</p>
   </div><!-- Error Screen -->
   <div id="error-screen" class="min-h-full hidden flex-col items-center justify-center p-4">
    <div class="error-container bg-white/10 backdrop-blur-sm rounded-3xl p-8 max-w-md text-center">
     <div class="text-6xl mb-4">
      üòî
     </div>
     <h2 id="error-title" class="text-2xl font-bold text-white mb-4"></h2>
     <p id="error-message" class="text-blue-200 mb-6"></p><button onclick="location.reload()" class="bg-yellow-400 hover:bg-yellow-300 text-blue-900 font-bold py-3 px-6 rounded-xl transition-all"> üîÑ Reintentar </button>
    </div>
   </div><!-- Main Menu -->
   <div id="main-menu" class="min-h-full hidden flex-col items-center p-4 py-8">
    <div class="text-center mb-8">
     <div class="text-6xl mb-2">
      üöå
     </div>
     <h1 id="game-title" class="text-4xl md:text-5xl font-bold text-white drop-shadow-lg">VITRASA MEMORY</h1>
     <p class="text-blue-200 mt-2">¬°Encuentra las parejas de im√°genes!</p>
    </div>
    <div class="bg-white/10 backdrop-blur-sm rounded-3xl p-6 w-full max-w-4xl">
     <h2 class="text-xl font-bold text-white mb-4 text-center">üéÆ Selecciona un nivel</h2>
     <div id="levels-grid" class="grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 gap-2"><!-- Levels will be generated here -->
     </div>
     <div class="mt-6 text-center">
      <p class="text-blue-200 text-sm"><span id="completed-count">0</span> / 60 niveles completados</p>
      <div class="w-full h-2 bg-blue-950 rounded-full mt-2 overflow-hidden">
       <div id="progress-bar" class="h-full bg-gradient-to-r from-yellow-400 to-green-400 rounded-full transition-all duration-500" style="width: 0%"></div>
      </div>
     </div>
    </div>
    <div class="mt-6 text-blue-300 text-sm text-center">
     <p>üí° Consejo: Completa niveles para desbloquear los siguientes</p>
    </div>
   </div><!-- Game Screen -->
   <div id="game-screen" class="min-h-full hidden flex-col p-4">
    <div class="flex items-center justify-between mb-4"><button id="back-btn" onclick="backToProfiles()" class="bg-white/20 hover:bg-white/30 text-white font-bold py-2 px-4 rounded-xl transition-all flex items-center gap-2"> ‚Üê Volver </button>
     <div class="text-center">
      <h2 id="level-title" class="text-xl font-bold text-white">Nivel 1</h2>
      <p id="pairs-info" class="text-blue-200 text-sm">2 pares</p>
     </div>
     <div class="text-right">
      <p class="text-yellow-400 font-bold"><span id="moves-count">0</span> movimientos</p>
      <p class="text-blue-200 text-sm"><span id="matches-count">0</span>/<span id="total-pairs">0</span> parejas</p>
     </div>
    </div>
    <div id="game-board" class="flex-1 flex items-center justify-center">
     <div id="cards-grid" class="grid gap-2 w-full max-w-4xl mx-auto"><!-- Cards will be generated here -->
     </div>
    </div>
   </div><!-- Victory Modal -->
   <div id="victory-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center p-4 z-50">
    <div class="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-3xl p-8 max-w-sm w-full text-center transform scale-0 transition-transform duration-300" id="victory-content">
     <div class="text-6xl mb-4">
      üéâ
     </div>
     <h2 class="text-3xl font-bold text-white mb-2">¬°Nivel Completado!</h2>
     <p class="text-white/90 mb-4">Nivel <span id="victory-level">1</span></p>
     <p class="text-white font-bold mb-6">En <span id="victory-moves">0</span> movimientos</p>
     <div class="flex flex-col gap-3"><button onclick="nextLevel()" id="next-level-btn" class="bg-white hover:bg-gray-100 text-orange-600 font-bold py-3 px-6 rounded-xl transition-all"> ‚ñ∂Ô∏è Siguiente nivel </button> <button onclick="replayLevel()" class="bg-white/30 hover:bg-white/40 text-white font-bold py-3 px-6 rounded-xl transition-all"> üîÑ Repetir nivel </button> <button onclick="hideVictoryModal(); backToProfiles()" class="bg-white/20 hover:bg-white/30 text-white font-bold py-2 px-4 rounded-xl transition-all"> üè† Men√∫ principal </button>
     </div>
    </div>
   </div>
  </div>
  <script>
    // Configuration
    const JSON_URL = 'https://lucasmaneirodelatm-dot.github.io/vitrasamemory/public/data.json';
    const TOTAL_LEVELS = 60;
    const MAX_PAIRS = 100;
    const ADMIN_PASSWORD = 'vitrasa2024';

    // Game state
    let config = { ...defaultConfig };
    let imageData = [];
    let profiles = [];
    let currentProfile = null;
    let unlockedLevels = 1;
    let completedLevels = new Set();
    let currentLevel = 1;
    let cards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    let moves = 0;
    let isLocked = false;
    let isAdminMode = false;
    let currentProfileIndex = -1;

    // Calculate pairs for each level
    function getPairsForLevel(level) {
      // Levels 1-10: 1 pair increment (2, 3, 4, 5, 6, 7, 8, 9, 10, 11 pairs)
      // Levels 11-60: 2 pairs increment
      if (level <= 10) {
        return level + 1; // 2 to 11 pairs
      } else {
        // Level 11 starts at 13 pairs (11 + 2), then +2 for each level
        return 11 + (level - 10) * 2; // 13, 15, 17, ... up to ~111 pairs at level 60
      }
    }

    function updateUI() {
      const titleEl = document.getElementById('profile-title');
      if (titleEl) titleEl.textContent = 'VITRASA MEMORY';
    }

    // Profile Management
    function loadProfiles() {
      try {
        const saved = localStorage.getItem('vitrasa_memory_profiles');
        if (saved) {
          profiles = JSON.parse(saved);
        } else {
          profiles = [];
          saveProfiles();
        }
      } catch (e) {
        console.error('Error loading profiles:', e);
        profiles = [];
      }
    }

    function saveProfiles() {
      localStorage.setItem('vitrasa_memory_profiles', JSON.stringify(profiles));
    }

    function saveCurrentProgress() {
      if (currentProfile !== null) {
        profiles[currentProfile].unlocked = unlockedLevels;
        profiles[currentProfile].completed = Array.from(completedLevels);
        saveProfiles();
      }
    }

    function loadCurrentProgress() {
      if (currentProfile !== null) {
        unlockedLevels = profiles[currentProfile].unlocked || 1;
        completedLevels = new Set(profiles[currentProfile].completed || []);
      }
    }

    function showProfileScreen() {
      document.getElementById('profile-screen').classList.remove('hidden');
      document.getElementById('profile-screen').classList.add('flex');
      document.getElementById('admin-screen').classList.add('hidden');
      document.getElementById('admin-screen').classList.remove('flex');
      document.getElementById('loading-screen').classList.add('hidden');
      document.getElementById('error-screen').classList.add('hidden');
      document.getElementById('error-screen').classList.remove('flex');
      document.getElementById('main-menu').classList.add('hidden');
      document.getElementById('main-menu').classList.remove('flex');
      document.getElementById('game-screen').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('flex');
      
      generateProfileButtons();
      updateUI();
    }

    function generateProfileButtons() {
      const list = document.getElementById('profiles-list');
      list.innerHTML = '';
      
      profiles.forEach((profile, index) => {
        const btn = document.createElement('button');
        btn.className = 'bg-yellow-400 hover:bg-yellow-300 text-blue-900 font-bold py-4 px-6 rounded-xl transition-all flex flex-col items-center gap-2';
        btn.innerHTML = `
          <div class="text-3xl">üë§</div>
          <div class="text-lg">${profile.name}</div>
          <div class="text-xs text-blue-800">${profile.completed.length}/60 niveles</div>
        `;
        btn.onclick = () => selectProfile(index);
        list.appendChild(btn);
      });
      
      // Delete buttons for each profile (except first)
      profiles.forEach((profile, index) => {
        if (index > 0) {
          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'col-span-1 md:col-span-2 text-red-400 hover:text-red-300 text-sm underline mt-2';
          deleteBtn.textContent = `üóëÔ∏è Eliminar "${profile.name}"`;
          deleteBtn.onclick = (e) => {
            e.stopPropagation();
            if (confirm(`¬øEliminar perfil "${profile.name}"?`)) {
              profiles.splice(index, 1);
              saveProfiles();
              generateProfileButtons();
            }
          };
          // This is a workaround, we'll add delete buttons after
        }
      });
    }

    function selectProfile(index) {
      currentProfileIndex = index;
      currentProfile = index;
      loadCurrentProgress();
      showMainMenu();
    }

    function createNewProfile() {
      const nameInput = document.getElementById('new-profile-name');
      const name = nameInput.value.trim();
      
      if (!name) {
        alert('Por favor ingresa un nombre para el perfil');
        return;
      }
      
      if (profiles.some(p => p.name.toLowerCase() === name.toLowerCase())) {
        alert('Ya existe un perfil con ese nombre');
        return;
      }
      
      profiles.push({
        name: name,
        unlocked: 1,
        completed: []
      });
      
      saveProfiles();
      nameInput.value = '';
      generateProfileButtons();
    }

    function showAdminPanel() {
      document.getElementById('profile-screen').classList.add('hidden');
      document.getElementById('profile-screen').classList.remove('flex');
      document.getElementById('admin-screen').classList.remove('hidden');
      document.getElementById('admin-screen').classList.add('flex');
      document.getElementById('admin-login').classList.remove('hidden');
      document.getElementById('admin-panel').classList.add('hidden');
      document.getElementById('admin-password').value = '';
    }

    function validateAdminPassword() {
      const password = document.getElementById('admin-password').value;
      if (password === ADMIN_PASSWORD) {
        isAdminMode = true;
        document.getElementById('admin-login').classList.add('hidden');
        document.getElementById('admin-panel').classList.remove('hidden');
      } else {
        alert('‚ùå Contrase√±a incorrecta');
      }
    }

    function backToProfiles() {
      isAdminMode = false;
      showProfileScreen();
    }

    function downloadJSONTemplate() {
      const template = [];
      
      // Generate template with proper structure
      for (let i = 0; i < 100; i++) {
        template.push({
          id: i + 1,
          url: `https://ejemplo.com/imagen-${i + 1}.jpg`,
          name: `Imagen ${i + 1}`
        });
      }
      
      const json = JSON.stringify(template, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'vitrasa_memory_template.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function downloadLevelGuide() {
      let guide = 'GU√çA DE NIVELES - VITRASA MEMORY\n\n';
      guide += 'Estructura de Parejas por Nivel:\n\n';
      
      for (let level = 1; level <= 60; level++) {
        const pairs = getPairsForLevel(level);
        guide += `Nivel ${level}: ${pairs} parejas (${pairs * 2} im√°genes)\n`;
      }
      
      guide += '\n\nEstructura del JSON:\n';
      guide += '[\n';
      guide += '  {\n';
      guide += '    "id": 1,\n';
      guide += '    "url": "https://ejemplo.com/imagen.jpg",\n';
      guide += '    "name": "Descripci√≥n"\n';
      guide += '  },\n';
      guide += '  ...\n';
      guide += ']\n\n';
      guide += 'M√≠nimo necesario: 100 im√°genes para todos los 60 niveles';
      
      const blob = new Blob([guide], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'vitrasa_memory_guia_niveles.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function exportAllProgress() {
      const data = {
        timestamp: new Date().toISOString(),
        profiles: profiles
      };
      
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `vitrasa_memory_backup_${new Date().toISOString().slice(0, 10)}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function resetAllProgress() {
      if (confirm('‚ö†Ô∏è ¬øEst√°s seguro? Esto borrar√° TODO el progreso de todos los perfiles.')) {
        if (confirm('‚ö†Ô∏è CONFIRMACI√ìN FINAL: ¬øRealmente deseas borrar todo?')) {
          profiles = [];
          saveProfiles();
          alert('‚úÖ Todos los datos han sido borrados');
          backToProfiles();
        }
      }
    }

    // Error handling
    function showError(title, message) {
      document.getElementById('loading-screen').classList.add('hidden');
      document.getElementById('main-menu').classList.add('hidden');
      document.getElementById('main-menu').classList.remove('flex');
      document.getElementById('game-screen').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('flex');
      
      document.getElementById('error-screen').classList.remove('hidden');
      document.getElementById('error-screen').classList.add('flex');
      document.getElementById('error-title').textContent = title;
      document.getElementById('error-message').textContent = message;
    }

    // Load JSON data
    async function loadImageData() {
      const loadingBar = document.getElementById('loading-bar');
      const loadingText = document.getElementById('loading-text');
      
      try {
        loadingBar.style.width = '20%';
        loadingText.textContent = 'Conectando con el servidor...';
        
        const response = await fetch(JSON_URL);
        
        if (!response.ok) {
          showError('‚ùåÔ∏èüìÑ JSON no encontrado', `No se pudo acceder al archivo de datos. Error: ${response.status}`);
          return false;
        }
        
        loadingBar.style.width = '50%';
        loadingText.textContent = 'Descargando datos...';
        
        let data;
        try {
          data = await response.json();
        } catch (parseError) {
          showError('‚ùåÔ∏èüìÑ JSON en formato inv√°lido', 'El archivo de datos no tiene un formato JSON v√°lido.');
          return false;
        }
        
        loadingBar.style.width = '80%';
        loadingText.textContent = 'Procesando im√°genes...';
        
        // Extract images from JSON - handle different formats
        if (Array.isArray(data)) {
          // If it's an array of objects with url/image property
          imageData = data.map(item => {
            if (typeof item === 'string') return item;
            return item.url || item.image || item.src || item.img || Object.values(item)[0];
          }).filter(url => url && typeof url === 'string');
        } else if (typeof data === 'object') {
          // If it's an object, get all string values
          imageData = Object.values(data).flat().map(item => {
            if (typeof item === 'string') return item;
            if (typeof item === 'object') return item.url || item.image || item.src || item.img;
            return null;
          }).filter(url => url && typeof url === 'string');
        }
        
        // Check if we have enough images
        const requiredImages = getPairsForLevel(TOTAL_LEVELS);
        if (imageData.length < requiredImages) {
          // We still have some images, adjust available levels
          console.warn(`Solo hay ${imageData.length} im√°genes, algunas niveles no estar√°n disponibles`);
        }
        
        if (imageData.length === 0) {
          showError('‚ùåÔ∏èüìÑ JSON vac√≠o o incompleto', 'No se encontraron im√°genes en el archivo de datos.');
          return false;
        }
        
        loadingBar.style.width = '100%';
        loadingText.textContent = '¬°Listo!';
        
        // Load saved progress
        loadProgress();
        
        setTimeout(() => {
          showMainMenu();
        }, 500);
        
        return true;
        
      } catch (error) {
        showError('‚ùåÔ∏èüìÑ JSON no encontrado', `Error de conexi√≥n: ${error.message}`);
        return false;
      }
    }

    // Save/Load progress
    function saveProgress() {
      const progress = {
        unlocked: unlockedLevels,
        completed: Array.from(completedLevels)
      };
      localStorage.setItem('vitrasa_memory_progress', JSON.stringify(progress));
    }

    function loadProgress() {
      try {
        const saved = localStorage.getItem('vitrasa_memory_progress');
        if (saved) {
          const progress = JSON.parse(saved);
          unlockedLevels = progress.unlocked || 1;
          completedLevels = new Set(progress.completed || []);
        }
      } catch (e) {
        console.error('Error loading progress:', e);
      }
    }

    // Show main menu
    function showMainMenu() {
      document.getElementById('profile-screen').classList.add('hidden');
      document.getElementById('profile-screen').classList.remove('flex');
      document.getElementById('loading-screen').classList.add('hidden');
      document.getElementById('error-screen').classList.add('hidden');
      document.getElementById('error-screen').classList.remove('flex');
      document.getElementById('game-screen').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('flex');
      
      document.getElementById('main-menu').classList.remove('hidden');
      document.getElementById('main-menu').classList.add('flex');
      
      updateUI();
      generateLevelButtons();
      updateProgressDisplay();
    }

    function backToProfiles() {
      saveCurrentProgress();
      currentProfile = null;
      showProfileScreen();
    }

    function generateLevelButtons() {
      const grid = document.getElementById('levels-grid');
      grid.innerHTML = '';
      
      for (let i = 1; i <= TOTAL_LEVELS; i++) {
        const pairs = getPairsForLevel(i);
        const isUnlocked = i <= unlockedLevels;
        const isCompleted = completedLevels.has(i);
        const hasEnoughImages = imageData.length >= pairs;
        
        const btn = document.createElement('button');
        btn.className = `level-btn w-full aspect-square rounded-xl font-bold text-sm transition-all ${
          isCompleted 
            ? 'bg-green-500 text-white' 
            : isUnlocked && hasEnoughImages
              ? 'bg-yellow-400 hover:bg-yellow-300 text-blue-900' 
              : 'bg-blue-950/50 text-blue-400 locked'
        }`;
        
        if (!hasEnoughImages && isUnlocked) {
          btn.className = 'level-btn w-full aspect-square rounded-xl font-bold text-sm transition-all bg-red-900/50 text-red-300 locked';
          btn.title = `Necesita ${pairs} im√°genes, solo hay ${imageData.length}`;
        }
        
        btn.innerHTML = isCompleted ? `‚úì` : (isUnlocked && hasEnoughImages ? i : 'üîí');
        btn.dataset.level = i;
        
        if (isUnlocked && hasEnoughImages) {
          btn.onclick = () => startLevel(i);
        } else if (!hasEnoughImages) {
          btn.onclick = () => {
            showError('‚ùåÔ∏èüìÑ JSON vac√≠o o incompleto', 
              `El nivel ${i} requiere ${pairs} im√°genes pero solo hay ${imageData.length} disponibles en el JSON.`);
          };
        }
        
        grid.appendChild(btn);
      }
    }

    function updateProgressDisplay() {
      document.getElementById('completed-count').textContent = completedLevels.size;
      document.getElementById('progress-bar').style.width = `${(completedLevels.size / TOTAL_LEVELS) * 100}%`;
    }

    // Start level
    function startLevel(level) {
      const pairs = getPairsForLevel(level);
      
      if (imageData.length < pairs) {
        showError('‚ùåÔ∏èüìÑ JSON vac√≠o o incompleto', 
          `El nivel ${level} requiere ${pairs} im√°genes pero solo hay ${imageData.length} disponibles en el JSON.`);
        return;
      }
      
      currentLevel = level;
      matchedPairs = 0;
      moves = 0;
      flippedCards = [];
      isLocked = false;
      
      document.getElementById('main-menu').classList.add('hidden');
      document.getElementById('main-menu').classList.remove('flex');
      document.getElementById('game-screen').classList.remove('hidden');
      document.getElementById('game-screen').classList.add('flex');
      
      document.getElementById('level-title').textContent = `Nivel ${level}`;
      document.getElementById('pairs-info').textContent = `${pairs} parejas`;
      document.getElementById('moves-count').textContent = '0';
      document.getElementById('matches-count').textContent = '0';
      document.getElementById('total-pairs').textContent = pairs;
      
      generateCards(pairs);
    }

    function generateCards(pairs) {
      // Shuffle and pick images
      const shuffledImages = [...imageData].sort(() => Math.random() - 0.5).slice(0, pairs);
      
      // Create pairs
      cards = [];
      shuffledImages.forEach((url, index) => {
        cards.push({ id: index * 2, pairId: index, url, matched: false });
        cards.push({ id: index * 2 + 1, pairId: index, url, matched: false });
      });
      
      // Shuffle cards
      cards.sort(() => Math.random() - 0.5);
      
      // Calculate grid layout
      const totalCards = cards.length;
      let cols = Math.ceil(Math.sqrt(totalCards * 1.5));
      let rows = Math.ceil(totalCards / cols);
      
      // Adjust for better layouts
      if (totalCards <= 8) cols = 4;
      else if (totalCards <= 12) cols = 4;
      else if (totalCards <= 20) cols = 5;
      else if (totalCards <= 30) cols = 6;
      else if (totalCards <= 48) cols = 8;
      else if (totalCards <= 80) cols = 10;
      else cols = 12;
      
      rows = Math.ceil(totalCards / cols);
      
      const grid = document.getElementById('cards-grid');
      grid.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
      grid.innerHTML = '';
      
      // Calculate card size based on grid
      const maxCardSize = Math.min(80, Math.floor(800 / cols));
      
      cards.forEach((card, index) => {
        const cardEl = document.createElement('div');
        cardEl.className = 'card-container cursor-pointer';
        cardEl.style.cssText = `width: 100%; max-width: ${maxCardSize}px; aspect-ratio: 1;`;
        cardEl.dataset.index = index;
        cardEl.innerHTML = `
          <div class="card-inner w-full h-full relative" id="card-${index}">
            <div class="card-front absolute inset-0 bg-gradient-to-br from-blue-600 to-blue-800 rounded-lg flex items-center justify-center shadow-lg border-2 border-blue-400">
              <span class="text-2xl">üöå</span>
            </div>
            <div class="card-back absolute inset-0 bg-white rounded-lg overflow-hidden shadow-lg border-2 border-yellow-400">
              <img src="${card.url}" alt="Card" class="w-full h-full object-cover" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22 font-size=%2240%22>üñºÔ∏è</text></svg>'">
            </div>
          </div>
        `;
        cardEl.onclick = () => flipCard(index);
        grid.appendChild(cardEl);
      });
    }

    function flipCard(index) {
      if (isLocked) return;
      if (cards[index].matched) return;
      if (flippedCards.includes(index)) return;
      if (flippedCards.length >= 2) return;
      
      const cardInner = document.getElementById(`card-${index}`);
      cardInner.classList.add('flipped');
      flippedCards.push(index);
      
      if (flippedCards.length === 2) {
        moves++;
        document.getElementById('moves-count').textContent = moves;
        checkMatch();
      }
    }

    function checkMatch() {
      isLocked = true;
      const [first, second] = flippedCards;
      
      if (cards[first].pairId === cards[second].pairId) {
        // Match!
        cards[first].matched = true;
        cards[second].matched = true;
        matchedPairs++;
        document.getElementById('matches-count').textContent = matchedPairs;
        
        const card1 = document.getElementById(`card-${first}`);
        const card2 = document.getElementById(`card-${second}`);
        card1.classList.add('card-matched');
        card2.classList.add('card-matched');
        
        flippedCards = [];
        isLocked = false;
        
        // Check win
        if (matchedPairs === cards.length / 2) {
          setTimeout(showVictory, 500);
        }
      } else {
        // No match
        const card1 = document.getElementById(`card-${first}`);
        const card2 = document.getElementById(`card-${second}`);
        card1.classList.add('shake');
        card2.classList.add('shake');
        
        setTimeout(() => {
          card1.classList.remove('flipped', 'shake');
          card2.classList.remove('flipped', 'shake');
          flippedCards = [];
          isLocked = false;
        }, 1000);
      }
    }

    function showVictory() {
      // Mark level as completed
      completedLevels.add(currentLevel);
      if (currentLevel >= unlockedLevels && currentLevel < TOTAL_LEVELS) {
        unlockedLevels = currentLevel + 1;
      }
      saveProgress();
      
      // Create confetti
      for (let i = 0; i < 50; i++) {
        setTimeout(() => createConfetti(), i * 30);
      }
      
      // Show modal
      document.getElementById('victory-level').textContent = currentLevel;
      document.getElementById('victory-moves').textContent = moves;
      document.getElementById('victory-modal').classList.remove('hidden');
      document.getElementById('victory-modal').classList.add('flex');
      
      // Check if next level is available
      const nextPairs = getPairsForLevel(currentLevel + 1);
      const nextBtn = document.getElementById('next-level-btn');
      if (currentLevel >= TOTAL_LEVELS) {
        nextBtn.textContent = 'üèÜ ¬°Completaste todos los niveles!';
        nextBtn.disabled = true;
        nextBtn.classList.add('opacity-50');
      } else if (imageData.length < nextPairs) {
        nextBtn.textContent = '‚ö†Ô∏è Siguiente nivel no disponible';
        nextBtn.disabled = true;
        nextBtn.classList.add('opacity-50');
      } else {
        nextBtn.textContent = '‚ñ∂Ô∏è Siguiente nivel';
        nextBtn.disabled = false;
        nextBtn.classList.remove('opacity-50');
      }
      
      setTimeout(() => {
        document.getElementById('victory-content').style.transform = 'scale(1)';
      }, 100);
    }

    function hideVictoryModal() {
      document.getElementById('victory-content').style.transform = 'scale(0)';
      setTimeout(() => {
        document.getElementById('victory-modal').classList.add('hidden');
        document.getElementById('victory-modal').classList.remove('flex');
      }, 300);
    }

    function createConfetti() {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = `${Math.random() * 100}vw`;
      confetti.style.backgroundColor = ['#fbbf24', '#22c55e', '#3b82f6', '#ec4899', '#f97316'][Math.floor(Math.random() * 5)];
      confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 3000);
    }

    function nextLevel() {
      hideVictoryModal();
      setTimeout(() => {
        if (currentLevel < TOTAL_LEVELS) {
          startLevel(currentLevel + 1);
        }
      }, 400);
    }

    function replayLevel() {
      hideVictoryModal();
      setTimeout(() => {
        startLevel(currentLevel);
      }, 400);
    }

    // Initialize
    async function init() {
      loadProfiles();
      await loadImageData();
      showProfileScreen();
    }
    
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d58410a039eec9e',t:'MTc3MjM2OTA3Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
